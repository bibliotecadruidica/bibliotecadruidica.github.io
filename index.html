<!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Biblioteca Druídica</title><meta name="description" content="Acervo de RPG."><link rel="shortcut icon" type="image/x-icon" href="./image/favicon.webp"><link rel="preconnect" href="https://unpkg.com"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://cdnjs.cloudflare.com"><script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script><script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script><script src="https://unpkg.com/@babel/standalone/babel.min.js"></script><script src="https://cdn.tailwindcss.com"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script><script>const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script><script>tailwind.config={theme:{extend:{fontFamily:{inter:["Inter","sans-serif"]}}}}</script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><style>:root{--primary-color:#111827;--secondary-color:#1f2937;--text-color:#f9fafb;--hover-color:#374151;--border-color:#4b5563;--transition-speed:.4s;--sidebar-width:320px}.menu-toggle,.sidebar{font-family:Inter,sans-serif}body{transition:margin-left var(--transition-speed) ease;background:linear-gradient(rgba(17,24,39,.85),rgba(17,24,39,.85)),url(image/bg2.webp);background-size:cover;background-position:center;background-attachment:fixed;min-height:100vh}.sidebar{position:fixed;top:0;left:0;height:100%;width:var(--sidebar-width);background:var(--secondary-color);z-index:999;padding:15px;display:flex;flex-direction:column;transform:translateX(-100%);transition:transform var(--transition-speed) ease-in-out;box-shadow:2px 0 10px rgba(0,0,0,.2)}.sidebar.active{transform:translateX(0)}.sidebar-header{display:flex;align-items:center;padding-bottom:15px;margin-bottom:15px;border-bottom:1px solid var(--border-color)}.sidebar-header .logo-icon{font-size:28px;color:var(--text-color);margin-right:15px}.sidebar-header .logo-text{font-size:20px;font-weight:600;color:var(--text-color)}.sidebar-nav{list-style:none;flex-grow:1;overflow-y:auto}.nav-link{display:flex;align-items:center;padding:12px 15px;color:var(--text-color);text-decoration:none;border-radius:8px;cursor:pointer;transition:background .2s}.nav-link:hover{background-color:var(--hover-color)}.submenu{list-style:none;padding-left:25px;max-height:0;overflow:hidden;transition:max-height .35s ease-in-out}.nav-item.dropdown-active>.submenu{max-height:500px}.menu-toggle{position:fixed;top:20px;left:20px;z-index:1000;background:var(--primary-color);border:1px solid var(--border-color);color:#fff;padding:10px;cursor:pointer;border-radius:8px;width:45px;height:45px;transition:left var(--transition-speed) ease-in-out}.sidebar.active~.menu-toggle{left:calc(var(--sidebar-width) + 20px)}#pdf-canvas-container{background-color:#2d3748;border-radius:8px;overflow:auto;max-height:80vh;border:1px solid #4a5568}@media (min-width:769px){.sidebar.active~main{margin-left:var(--sidebar-width)}}</style></head><body><div id="root-app"></div><script type="text/babel">let booksData = [];
        let descriptionsData = {};

        // Componente de Visualização de PDF
        const PDFViewer = ({ url, title }) => {
            const canvasRef = React.useRef(null);
            const [pdf, setPdf] = React.useState(null);
            const [pageNum, setPageNum] = React.useState(1);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);

            React.useEffect(() => {
                const loadPDF = async () => {
                    setLoading(true);
                    setError(null);
                    try {
                        // Nota: Links do Google Drive precisam ser convertidos para link de download direto
                        // ou servidos via proxy se houver restrição de CORS.
                        const loadingTask = pdfjsLib.getDocument(url);
                        const pdfDoc = await loadingTask.promise;
                        setPdf(pdfDoc);
                        renderPage(1, pdfDoc);
                    } catch (err) {
                        console.error("Erro ao carregar PDF:", err);
                        setError("Não foi possível carregar a pré-visualização direta deste tomo. Alguns servidores (como Google Drive) restringem o acesso direto.");
                    } finally {
                        setLoading(false);
                    }
                };
                loadPDF();
            }, [url]);

            const renderPage = async (num, pdfDoc = pdf) => {
                if (!pdfDoc || !canvasRef.current) return;
                const page = await pdfDoc.getPage(num);
                const viewport = page.getViewport({ scale: 1.5 });
                const canvas = canvasRef.current;
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                await page.render(renderContext).promise;
            };

            const changePage = (offset) => {
                const newPage = pageNum + offset;
                if (newPage >= 1 && newPage <= pdf.numPages) {
                    setPageNum(newPage);
                    renderPage(newPage);
                }
            };

            return (
                <div className="w-full bg-gray-900 p-4 rounded-xl shadow-2xl mt-6 border border-gray-700">
                    <div className="flex justify-between items-center mb-4 text-white">
                        <span className="text-sm font-medium">Página {pageNum} de {pdf ? pdf.numPages : '?'}</span>
                        <div className="flex space-x-2">
                            <button onClick={() => changePage(-1)} disabled={pageNum <= 1} className="p-2 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-30">
                                <i className="fa-solid fa-chevron-left"></i>
                            </button>
                            <button onClick={() => changePage(1)} disabled={!pdf || pageNum >= pdf.numPages} className="p-2 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-30">
                                <i className="fa-solid fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>

                    {loading && <div className="text-center py-20 text-green-500 font-bold animate-pulse">Invocando conhecimento...</div>}
                    
                    {error ? (
                        <div className="bg-red-900/30 border border-red-500 p-6 rounded-lg text-center">
                            <p className="text-red-200 mb-4">{error}</p>
                            <a href={url} target="_blank" rel="noopener noreferrer" className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                                Abrir em nova aba <i className="fa-solid fa-up-right-from-square ml-2"></i>
                            </a>
                        </div>
                    ) : (
                        <div id="pdf-canvas-container" className="flex justify-center">
                            <canvas ref={canvasRef} className="max-w-full shadow-lg" />
                        </div>
                    )}
                </div>
            );
        };

        const Book = ({ title, author, imageUrl, onSelectBook }) => (
            <article 
                className="bg-gray-800 bg-opacity-0 hover:bg-opacity-50 p-4 rounded-lg shadow-lg flex flex-col items-center text-center transform hover:scale-105 transition-all duration-300 ease-in-out cursor-pointer h-full border border-transparent hover:border-gray-600"
                onClick={onSelectBook}
            >
                <figure className="mb-4 flex-shrink-0">
                    <img src={imageUrl} alt={title} className="w-48 h-64 object-cover rounded-md shadow-md" loading="lazy" />
                </figure>
                <div className="flex flex-col justify-start flex-grow">
                    <h2 className="text-white text-lg font-semibold mb-1 line-clamp-2">{title}</h2>
                    <p className="text-gray-400 text-sm">{author}</p>
                </div>
            </article>
        );

        const BookDetail = ({ book, onBackToList }) => (
            <div className="flex flex-col items-center bg-gray-800 bg-opacity-50 p-4 md:p-8 rounded-lg shadow-xl max-w-5xl mx-auto my-4">
                <div className="w-full flex justify-between items-center mb-6">
                    <button onClick={onBackToList} className="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors shadow-md">
                        &larr; Voltar
                    </button>
                    <a href={book.driveLink} target="_blank" rel="noopener noreferrer" className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-bold">
                        Download <i className="fa-solid fa-download ml-2"></i>
                    </a>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 w-full">
                    <div className="flex flex-col items-center">
                        <img src={book.imageUrl} alt={book.title} className="w-64 h-auto rounded-lg shadow-2xl border-4 border-gray-700" />
                        <h1 className="text-white text-3xl font-bold mt-4 text-center">{book.title}</h1>
                        <p className="text-gray-400 text-lg mb-4 italic">{book.author}</p>
                        {book.description && <p className="text-gray-300 text-sm leading-relaxed text-justify">{book.description}</p>}
                    </div>
                    
                    <div>
                        <h3 className="text-green-400 font-bold mb-2 uppercase text-xs tracking-widest">Visualização do Tomo</h3>
                        <PDFViewer url={book.driveLink} title={book.title} />
                    </div>
                </div>
            </div>
        );

        const Sidebar = ({ isMenuOpen, toggleMenu, handleNavigate }) => {
            const [activeDropdown, setActiveDropdown] = React.useState(null);
            
            const categories = {
                'Dungeons & Dragons': ['D&D 5E', 'D&D 3.5'],
                'Mundo das Trevas': ['Mago a Ascensão', 'Vampiro a Máscara', 'Vampiro a Idade das Trevas', 'Vampiro o Réquiem'],
                'Cthulhu Mythos': ['Chamado de Cthulhu', 'Rastro de Cthulhu'],
                'Outros Sistemas': ['Tormenta', 'Old Dragon', '13ª Era', '7º Mar', 'Violentina', 'Angus RPG', '2Q RPG', 'Ação!!!']
            };

            return (
                <nav className={`sidebar ${isMenuOpen ? 'active' : ''}`} id="sidebar">
                    <div className="sidebar-header">
                        <i className="fa-solid fa-dungeon logo-icon text-green-500"></i>
                        <span className="logo-text">Bib. Druídica</span>
                    </div>
                    <ul className="sidebar-nav space-y-2">
                        <li className="nav-item">
                            <a className="nav-link" onClick={() => handleNavigate('home')}>
                                <i className="fa-solid fa-house icon mr-3"></i>
                                <span className="text">Início</span>
                            </a>
                        </li>
                        {Object.entries(categories).map(([cat, subs]) => (
                            <li key={cat} className={`nav-item ${activeDropdown === cat ? 'dropdown-active' : ''}`}>
                                <a className="nav-link justify-between" onClick={() => setActiveDropdown(activeDropdown === cat ? null : cat)}>
                                    <div className="flex items-center">
                                        <i className="fa-solid fa-book-journal-whills mr-3 opacity-70"></i>
                                        <span>{cat}</span>
                                    </div>
                                    <i className={`fa-solid fa-chevron-down text-xs transition-transform ${activeDropdown === cat ? 'rotate-180' : ''}`}></i>
                                </a>
                                <ul className="submenu bg-black bg-opacity-20 rounded-lg">
                                    {subs.map(s => (
                                        <li key={s}>
                                            <a className="block py-2 px-10 text-sm text-gray-400 hover:text-white hover:bg-gray-700 rounded-md" 
                                               onClick={() => { handleNavigate('category', s); if(window.innerWidth <= 768) toggleMenu(); }}>
                                                {s}
                                            </a>
                                        </li>
                                    ))}
                                </ul>
                            </li>
                        ))}
                    </ul>
                </nav>
            );
        };

        const App = () => {
            const [currentView, setCurrentView] = React.useState('home');
            const [selectedCategory, setSelectedCategory] = React.useState('');
            const [selectedBook, setSelectedBook] = React.useState(null);
            const [searchTerm, setSearchTerm] = React.useState('');
            const [isMenuOpen, setIsMenuOpen] = React.useState(false);
            const [currentPage, setCurrentPage] = React.useState(1);
            const booksPerPage = 20;

            const handleNavigate = (view, cat = '') => {
                setCurrentView(view);
                setSelectedCategory(cat);
                setSelectedBook(null);
                setSearchTerm('');
                setCurrentPage(1);
                window.scrollTo(0, 0);
            };

            const handleSelectBook = book => {
                const description = descriptionsData[book.title] || 'Nenhuma descrição disponível neste tomo.';
                setSelectedBook({ ...book, description });
                setCurrentView('book');
                window.scrollTo(0, 0);
            };

            const toggleMenu = () => setIsMenuOpen(!isMenuOpen);

            const filteredBooks = React.useMemo(() => {
                let list = booksData;
                if (currentView === 'category' && selectedCategory) list = list.filter(b => b.category === selectedCategory);
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    list = list.filter(b => b.title.toLowerCase().includes(term) || b.author.toLowerCase().includes(term));
                }
                return list;
            }, [currentView, selectedCategory, searchTerm]);

            const booksForDisplay = filteredBooks.slice((currentPage - 1) * booksPerPage, currentPage * booksPerPage);
            const totalPages = Math.ceil(filteredBooks.length / booksPerPage);

            const renderContent = () => {
                if (currentView === 'book' && selectedBook) {
                    return <BookDetail book={selectedBook} onBackToList={() => handleNavigate(selectedCategory ? 'category' : 'home', selectedCategory)} />;
                }

                return (
                    <>
                        <div className="text-center mb-12 pt-12">
                            <h1 className="text-5xl font-bold mb-4 text-white">
                                {currentView === 'category' ? selectedCategory : "Biblioteca Druídica"}
                            </h1>
                            <p className="text-xl text-gray-400">
                                {currentView === 'category' ? `Explorando segredos de ${selectedCategory}` : "O seu santuário de conhecimento de RPG."}
                            </p>
                        </div>

                        <div className="max-w-xl mx-auto mb-12">
                            <div className="relative">
                                <i className="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input 
                                    type="text" 
                                    placeholder="Procurar pergaminho..." 
                                    className="w-full pl-12 pr-5 py-3 bg-gray-800 border border-gray-700 rounded-full focus:ring-2 focus:ring-green-500 outline-none transition-all"
                                    value={searchTerm}
                                    onChange={e => { setSearchTerm(e.target.value); setCurrentPage(1); }}
                                />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-8">
                            {booksForDisplay.length > 0 ? (
                                booksForDisplay.map(b => <Book key={b.driveLink} {...b} onSelectBook={() => handleSelectBook(b)} />)
                            ) : (
                                <p className="col-span-full text-center text-gray-500 py-20 text-xl">Nenhum tomo encontrado na névoa...</p>
                            )}
                        </div>

                        {totalPages > 1 && (
                            <div className="flex justify-center mt-12 space-x-2">
                                {[...Array(totalPages)].map((_, i) => (
                                    <button 
                                        key={i} 
                                        onClick={() => { setCurrentPage(i + 1); window.scrollTo(0, 0); }}
                                        className={`w-10 h-10 rounded-full ${currentPage === i + 1 ? 'bg-green-600' : 'bg-gray-800 hover:bg-gray-700'}`}
                                    >
                                        {i + 1}
                                    </button>
                                ))}
                            </div>
                        )}
                    </>
                );
            };

            // Efeito para carregar dados
            React.useEffect(() => {
                async function load() {
                    try {
                        const [bRes, dRes] = await Promise.all([
                            fetch('./data/books.yml').then(r => r.text()),
                            fetch('./data/descriptions.yml').then(r => r.text())
                        ]);
                        booksData = jsyaml.load(bRes);
                        descriptionsData = jsyaml.load(dRes).reduce((acc, i) => ({ ...acc, [i.title]: i.description }), {});
                        setCurrentView('home'); // Força re-render inicial
                    } catch (e) { console.error("Erro ao carregar dados", e); }
                }
                load();
            }, []);

            return (
                <div className="min-h-screen text-gray-100 font-inter antialiased">
                    <Sidebar isMenuOpen={isMenuOpen} toggleMenu={toggleMenu} handleNavigate={handleNavigate} />
                    <button className="menu-toggle" onClick={toggleMenu}>
                        <i className={`fa-solid ${isMenuOpen ? 'fa-xmark' : 'fa-bars'}`}></i>
                    </button>
                    <main className="container mx-auto px-4 py-8 transition-all duration-300">
                        {renderContent()}
                    </main>
                    <footer className="mt-20 py-10 text-center border-t border-gray-800 opacity-50 text-sm">
                        <p>&copy; {new Date().getFullYear()} Biblioteca Druídica. Preservando a sabedoria dos anciãos.</p>
                    </footer>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root-app')).render(<App />);</script></body></html>
