<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Biblioteca Druídica</title><meta name="description" content="Acervo de RPG."><link rel="shortcut icon" type="image/x-icon" href="./images/favicon.ico"/>
<link rel="preconnect" href="https://unpkg.com"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://cdnjs.cloudflare.com">
<link rel="dns-prefetch" href="https://unpkg.com"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script><script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
<script>tailwind.config={theme:{extend:{fontFamily:{inter:['Inter','sans-serif'],},},},};</script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
:root{--primary-color:#111827;--secondary-color:#1f2937;--text-color:#f9fafb;--hover-color:#374151;--border-color:#4b5563;--sidebar-width:260px;--transition-speed:.4s;}
.sidebar,.menu-toggle{font-family:'Inter',sans-serif;}
body{transition:margin-left var(--transition-speed) ease;background:linear-gradient(rgba(17,24,39,0.85),rgba(17,24,39,0.85)),url('./images/bg2.png');background-size:cover;background-position:center;background-attachment:fixed;}
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.6);z-index:998;opacity:0;visibility:hidden;transition:opacity var(--transition-speed) ease,visibility var(--transition-speed) ease;}
#overlay.active{opacity:1;visibility:visible;}
.sidebar{position:fixed;top:0;left:0;height:100%;width:var(--sidebar-width);background:var(--secondary-color);z-index:999;padding:15px;display:flex;flex-direction:column;transform:translateX(-100%);transition:transform var(--transition-speed) ease-in-out;box-shadow:2px 0 10px rgba(0,0,0,0.2);}
.sidebar.active{transform:translateX(0);}
.sidebar-header{display:flex;align-items:center;padding-bottom:15px;margin-bottom:15px;border-bottom:1px solid var(--border-color);}
.sidebar-header .logo-icon{font-size:28px;color:var(--text-color);margin-right:15px;}
.sidebar-header .logo-text{font-size:20px;font-weight:600;color:var(--text-color);}
.sidebar-nav{list-style:none;flex-grow:1;overflow-y:auto;}
.nav-item{margin-bottom:5px;}
.nav-link{display:flex;align-items:center;padding:12px 15px;color:var(--text-color);text-decoration:none;border-radius:8px;white-space:nowrap;cursor:pointer;}
.nav-link:hover,.nav-link.active-link{background-color:var(--hover-color);}
.nav-link .icon{font-size:18px;min-width:40px;text-align:center;margin-right:10px;}
.nav-link .text{font-weight:400;}
.nav-item.has-dropdown .nav-link{position:relative;}
.dropdown-arrow{margin-left:auto;transition:transform .3s ease;}
.nav-item.dropdown-active>.nav-link .dropdown-arrow{transform:rotate(90deg);}
.submenu{list-style:none;padding-left:25px;max-height:0;overflow:hidden;transition:max-height .35s ease-in-out;}
.submenu-link{display:block;padding:10px 20px;color:#adb5bd;text-decoration:none;border-radius:5px;position:relative;cursor:pointer;}
.submenu-link::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:5px;height:5px;background-color:#adb5bd;border-radius:50%;}
.submenu-link:hover{background-color:var(--hover-color);color:white;}
.menu-toggle{position:fixed;top:20px;left:20px;z-index:1000;background:var(--primary-color);border:1px solid var(--border-color);color:white;padding:10px;cursor:pointer;border-radius:8px;display:flex;align-items:center;justify-content:center;width:45px;height:45px;box-shadow:0 2px 5px rgba(0,0,0,0.2);transition:left var(--transition-speed) ease-in-out,transform .3s ease;}
.menu-toggle:hover{transform:scale(1.1);background-color:var(--secondary-color);}
.sidebar.active~.menu-toggle{left:calc(var(--sidebar-width) + 20px);}
.menu-toggle .fa-bars,.menu-toggle .fa-xmark{font-size:24px;transition:transform .3s ease,opacity .3s ease;position:absolute;}
.menu-toggle .fa-xmark{opacity:0;transform:rotate(-90deg);}
.sidebar.active~.menu-toggle .fa-bars{opacity:0;transform:rotate(90deg);}
.sidebar.active~.menu-toggle .fa-xmark{opacity:1;transform:rotate(0deg);}
.main-content{padding-top:20px;padding-bottom:20px;transition:margin-left var(--transition-speed) ease-in-out;}
@media (min-width:769px){.sidebar.active~.main-content{margin-left:var(--sidebar-width);}}
@media (max-width:768px){.sidebar.active~.main-content{margin-left:0;}.sidebar.active~.menu-toggle{left:calc(var(--sidebar-width) - 60px);color:var(--text-color);background:transparent;border:none;box-shadow:none;}}
</style>
</head>
<body>
<div id="overlay"></div>
<div id="root-app"></div>
<script type="text/babel">
// O array booksData será carregado do arquivo YAML
let booksData = [];

// Função para carregar os dados do arquivo YAML
async function loadBooksData() {
    try {
        const response = await fetch('./data/books.yml'); // Caminho para o seu arquivo YAML
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const yamlText = await response.text();
        booksData = jsyaml.load(yamlText); // Usa jsyaml para parsear
        console.log('Dados dos livros carregados:', booksData);
        // Renderiza a aplicação somente após os dados serem carregados
        ReactDOM.createRoot(document.getElementById('root-app')).render(<App />);
    } catch (error) {
        console.error('Erro ao carregar os dados dos livros:', error);
        // Exiba uma mensagem de erro ou um fallback na interface do usuário, se necessário
        document.getElementById('root-app').innerHTML = '<p class="text-red-500 text-center text-xl mt-20">Erro ao carregar os livros. Por favor, tente novamente mais tarde.</p>';
    }
}

// Chame a função para carregar os dados quando o script for executado
loadBooksData();


const Book = ({ title, author, imageUrl, onSelectBook }) => {
    return (
        <article
            className="bg-gray-800 bg-opacity-0 hover:bg-opacity-50 p-4 rounded-lg shadow-lg flex flex-col items-center text-center transform hover:scale-105 transition-all duration-300 ease-in-out cursor-pointer h-full"
            onClick={onSelectBook}
        >
            <figure className="book-cover mb-4 flex-shrink-0">
                <img
                    src={imageUrl}
                    alt={title}
                    className="w-48 h-64 object-cover rounded-md shadow-md"
                    loading="lazy"
                    onError={(e) => {
                        e.target.onerror = null;
                        e.target.src = "https://placehold.co/192x256/2d3748/e2e8f0?text=Capa";
                    }}
                />
            </figure>
            <div className="book-info flex flex-col justify-start flex-grow">
                <h2 className="text-white text-lg font-semibold mb-1">{title}</h2>
                <p className="text-gray-400 text-sm">{author}</p>
            </div>
        </article>
    );
};

const BookDetail = ({ book, onBackToList }) => {
    return (
        <div className="flex flex-col items-center bg-gray-800 bg-opacity-50 p-8 rounded-lg shadow-xl max-w-4xl mx-auto my-8">
            <button
                onClick={onBackToList}
                className="self-start mb-6 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md"
            >
                &larr; Voltar
            </button>
            <h1 className="text-white text-4xl font-bold mb-4 text-center">{book.title}</h1>
            <p className="text-gray-300 text-lg mb-6 text-center">Por: {book.author}</p>
            <div className="book-cover mb-8">
                <a href={book.driveLink} target="_blank" rel="noopener noreferrer">
                    <img
                        src={book.imageUrl}
                        alt={book.title}
                        className="w-80 h-auto object-cover rounded-lg shadow-lg border-4 border-gray-700 hover:border-green-500 transition-colors"
                        loading="lazy"
                        onError={(e) => {
                            e.target.onerror = null;
                            e.target.src = "https://placehold.co/320x420/2d3748/e2e8f0?text=Capa+Indisponível";
                        }}
                    />
                </a>
            </div>
            <a
                href={book.driveLink}
                target="_blank"
                rel="noopener noreferrer"
                className="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors"
            >
                Acessar no Google Drive
            </a>
            <p className="text-gray-400 text-sm mt-4 text-center">Clique na capa ou no botão para abrir o arquivo no Google Drive.</p>
        </div>
    );
};

const Sidebar = ({ isMenuOpen, toggleMenu, handleNavigate }) => {
    const [activeDropdown, setActiveDropdown] = React.useState(null);
    const submenuRefs = React.useRef({});

    // Effect to toggle the 'active' class on the sidebar and overlay
    React.useEffect(() => {
        const sidebarElement = document.getElementById('sidebar');
        const overlayElement = document.getElementById('overlay');
        if (sidebarElement && overlayElement) {
            if (isMenuOpen) {
                sidebarElement.classList.add('active');
                overlayElement.classList.add('active');
            } else {
                sidebarElement.classList.remove('active');
                overlayElement.classList.remove('active');
            }
        }
    }, [isMenuOpen]);

    // Effect to handle submenu maxHeight transition
    React.useEffect(() => {
        Object.keys(submenuRefs.current).forEach(key => {
            const submenu = submenuRefs.current[key];
            if (submenu) {
                if (activeDropdown === key) {
                    submenu.style.maxHeight = submenu.scrollHeight + 'px';
                } else {
                    submenu.style.maxHeight = '0px';
                }
            }
        });
    }, [activeDropdown]);

    const toggleDropdown = (category) => {
        setActiveDropdown(activeDropdown === category ? null : category);
    };

    const handleNavLinkClick = (view, category) => {
        handleNavigate(view, category);
        if (window.innerWidth <= 768) {
            toggleMenu(); // Close menu on mobile after navigation
        }
    };

    const categories = {
        'Dungeons & Dragons': ['D&D 5E', 'D&D 3.5'],
        'Mundo das Trevas': ['Mago a Ascensão', 'Vampiro a Máscara', 'Vampiro a Idade das Trevas', 'Vampiro o Réquiem'],
        'Cthulhu Mythos': ['Chamado de Cthulhu', 'Rastro de Cthulhu'],
        'Outros Sistemas': ['Tormenta', 'Old Dragon', '13ª Era', '7º Mar', 'Violentina', 'Angus RPG', '2Q RPG', 'Ação!!!'],
    };

    return (
        <nav className="sidebar" id="sidebar">
            <div className="sidebar-header">
                <i className="fa-solid fa-dungeon logo-icon"></i>
                <span className="logo-text">Bib. Druídica</span>
            </div>
            <ul className="sidebar-nav">
                <li className="nav-item">
                    <a className="nav-link" onClick={() => handleNavLinkClick('home')}>
                        <i className="fa-solid fa-house icon"></i>
                        <span className="text">Início</span>
                    </a>
                </li>
                {Object.entries(categories).map(([mainCat, subCats]) => (
                    <li key={mainCat} className={`nav-item has-dropdown ${activeDropdown === mainCat ? 'dropdown-active' : ''}`}>
                        <a className="nav-link" onClick={() => toggleDropdown(mainCat)}>
                            <i className={`fa-solid ${mainCat === 'Dungeons & Dragons' ? 'fa-dragon' : mainCat === 'Mundo das Trevas' ? 'fa-hat-wizard' : mainCat === 'Cthulhu Mythos' ? 'fa-book-skull' : 'fa-scroll'} icon`}></i>
                            <span className="text">{mainCat}</span>
                            <i className="fa-solid fa-chevron-right dropdown-arrow"></i>
                        </a>
                        <ul className="submenu" ref={el => submenuRefs.current[mainCat] = el}>
                            {subCats.map(subCat => (
                                <li key={subCat}><a className="submenu-link" onClick={() => handleNavLinkClick('category', subCat)}>{subCat}</a></li>
                            ))}
                        </ul>
                    </li>
                ))}
            </ul>
        </nav>
    );
};

const App = () => {
    const [currentView, setCurrentView] = React.useState('home');
    const [selectedCategory, setSelectedCategory] = React.useState('');
    const [selectedBook, setSelectedBook] = React.useState(null);
    const [searchTerm, setSearchTerm] = React.useState('');
    const [isMenuOpen, setIsMenuOpen] = React.useState(false); // Menu state

    const handleNavigate = (view, category = '') => {
        setCurrentView(view);
        setSelectedCategory(category);
        setSelectedBook(null);
        setSearchTerm('');
        window.scrollTo(0, 0);
    };

    const handleSelectBook = (book) => {
        setSelectedBook(book);
        setCurrentView('book');
        window.scrollTo(0, 0);
    };

    const toggleMenu = () => {
        setIsMenuOpen(prev => !prev);
    };

    // Filter books for display based on current view and search term
    const booksForDisplay = React.useMemo(() => {
        let books = booksData; // Usa o booksData global carregado
        if (currentView === 'category' && selectedCategory) {
            books = booksData.filter(book => book.category === selectedCategory);
        }
        if (searchTerm) {
            return books.filter(book =>
                book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                book.author.toLowerCase().includes(searchTerm.toLowerCase())
            );
        }
        return books;
    }, [currentView, selectedCategory, searchTerm]);

    const renderContent = () => {
        if (currentView === 'book' && selectedBook) {
            return <BookDetail book={selectedBook} onBackToList={() => handleNavigate(selectedCategory ? 'category' : 'home', selectedCategory)} />;
        }

        let pageTitle = "Biblioteca Druídica";
        let pageSubtitle = "Seu acervo digital de livros de RPG.";
        if(currentView === 'category') {
            pageTitle = selectedCategory;
            pageSubtitle = `Livros e suplementos para ${selectedCategory}.`
        }

        return (
            <>
                <div className="text-center mb-10 pt-12">
                    <h1 className="text-4xl md:text-5xl font-bold mb-2 text-white">{pageTitle}</h1>
                    <p className="text-lg text-gray-300">{pageSubtitle}</p>
                    {currentView === 'category' && (
                        <button
                            onClick={() => handleNavigate('home')}
                            className="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md"
                        >
                            &larr; Voltar para o Início
                        </button>
                    )}
                </div>
                <div className="mb-10 w-full max-w-lg mx-auto">
                    <input
                        type="text"
                        placeholder="Buscar por título ou autor..."
                        className="w-full px-5 py-3 bg-gray-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 transition-shadow"
                        onChange={(e) => setSearchTerm(e.target.value)}
                        value={searchTerm}
                    />
                </div>
                <section className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-8">
                    {booksForDisplay.length > 0 ? (
                        booksForDisplay.map((book) => (
                            <Book
                                key={book.driveLink}
                                title={book.title}
                                author={book.author}
                                imageUrl={book.imageUrl}
                                onSelectBook={() => handleSelectBook(book)}
                            />
                        ))
                    ) : (
                        <p className="col-span-full text-center text-gray-400 text-xl">Nenhum livro encontrado.</p>
                    )}
                </section>
            </>
        );
    };

    // Effect for the body class based on menu state
    React.useEffect(() => {
        if (isMenuOpen && window.innerWidth <= 768) {
            document.body.style.marginLeft = '0'; // Forcing 0 margin for mobile when open
            document.body.classList.add('overflow-hidden'); // Prevent scrolling body when menu is open
        } else if (isMenuOpen && window.innerWidth > 768) {
            document.body.style.marginLeft = 'var(--sidebar-width)';
        } else {
            document.body.style.marginLeft = '0';
            document.body.classList.remove('overflow-hidden');
        }
    }, [isMenuOpen]);

    // Disable context menu (right-click)
    React.useEffect(() => {
        const handleContextMenu = (e) => e.preventDefault();
        document.addEventListener('contextmenu', handleContextMenu);
        return () => document.removeEventListener('contextmenu', handleContextMenu);
    }, []);

    return (
        <div className="min-h-screen text-gray-100 font-inter antialiased">
            <Sidebar isMenuOpen={isMenuOpen} toggleMenu={toggleMenu} handleNavigate={handleNavigate} />
            <button className={`menu-toggle ${isMenuOpen ? 'active' : ''}`} onClick={toggleMenu} aria-label="Toggle menu">
                <i className={`fa-solid fa-bars ${isMenuOpen ? 'hidden' : ''}`}></i>
                <i className={`fa-solid fa-xmark ${isMenuOpen ? '' : 'hidden'}`}></i>
            </button>
            <div id="overlay" className={isMenuOpen ? 'active' : ''} onClick={toggleMenu}></div>

            <main className="container mx-auto px-4 py-8">
                {renderContent()}
            </main>

            <footer className="bg-black bg-opacity-30 backdrop-blur-sm p-6 text-center text-gray-400 mt-12 rounded-t-lg">
                <p>&copy; {new Date().getFullYear()} Biblioteca Druídica. Todos os direitos reservados.</p>
                <div className="mt-4">
                    <p>Visite o canal na Twitch: <a href="https://www.twitch.tv/lukas_eso" target="_blank" rel="noopener noreferrer" className="text-purple-400 hover:underline">lukas_eso</a></p>
                </div>
            </footer>
        </div>
    );
};

// Remover esta linha, pois o render será chamado dentro de loadBooksData()
// ReactDOM.createRoot(document.getElementById('root-app')).render(<App />);
</script>
</body>
</html>
