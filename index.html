<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Biblioteca Druídica</title>
    <meta name="description" content="Acervo de RPG.">
    <link rel="shortcut icon" type="image/x-icon" href="./image/favicon.webp"/>
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://unpkg.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary-color: #111827;
            --secondary-color: #1f2937;
            --text-color: #f9fafb;
            --hover-color: #374151;
            --border-color: #4b5563;
            --transition-speed: .4s;
            --sidebar-width: 320px;
        }

        .sidebar, .menu-toggle {
            font-family: 'Inter', sans-serif;
        }

        body {
            transition: margin-left var(--transition-speed) ease;
            background: linear-gradient(rgba(17, 24, 39, 0.85), rgba(17, 24, 39, 0.85)), url('./image/bg2.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--transition-speed) ease, visibility var(--transition-speed) ease;
        }

        #overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--sidebar-width);
            background: var(--secondary-color);
            z-index: 999;
            padding: 15px;
            display: flex;
            flex-direction: column;
            transform: translateX(-100%);
            transition: transform var(--transition-speed) ease-in-out;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
        }

        .sidebar.active {
            transform: translateX(0);
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header .logo-icon {
            font-size: 28px;
            color: var(--text-color);
            margin-right: 15px;
        }

        .sidebar-header .logo-text {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
        }

        .sidebar-nav {
            list-style: none;
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .nav-item {
            margin-bottom: 5px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: var(--text-color);
            text-decoration: none;
            border-radius: 8px;
            white-space: nowrap;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active-link {
            background-color: var(--hover-color);
        }

        .nav-link .icon {
            font-size: 18px;
            min-width: 40px;
            text-align: center;
            margin-right: 10px;
        }

        .nav-link .text {
            font-weight: 400;
        }

        .nav-item.has-dropdown .nav-link {
            position: relative;
        }

        .dropdown-arrow {
            margin-left: auto;
            transition: transform .3s ease;
        }

        .nav-item.dropdown-active > .nav-link .dropdown-arrow {
            transform: rotate(90deg);
        }

        .submenu {
            list-style: none;
            padding-left: 25px;
            max-height: 0;
            overflow: hidden;
            transition: max-height .35s ease-in-out;
        }

        .submenu-link {
            display: block;
            padding: 10px 20px;
            color: #adb5bd;
            text-decoration: none;
            border-radius: 5px;
            position: relative;
            cursor: pointer;
        }

        .submenu-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 5px;
            height: 5px;
            background-color: #adb5bd;
            border-radius: 50%;
        }

        .submenu-link:hover {
            background-color: var(--hover-color);
            color: white;
        }

        .menu-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: var(--primary-color);
            border: 1px solid var(--border-color);
            color: white;
            padding: 10px;
            cursor: pointer;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: left var(--transition-speed) ease-in-out, transform .3s ease;
        }

        .menu-toggle:hover {
            transform: scale(1.1);
            background-color: var(--secondary-color);
        }

        .sidebar.active ~ .menu-toggle {
            left: calc(var(--sidebar-width) + 20px);
        }

        .menu-toggle .fa-bars, .menu-toggle .fa-xmark {
            font-size: 24px;
            transition: transform .3s ease, opacity .3s ease;
            position: absolute;
        }

        .menu-toggle .fa-xmark {
            opacity: 0;
            transform: rotate(-90deg);
        }

        .sidebar.active ~ .menu-toggle .fa-bars {
            opacity: 0;
            transform: rotate(90deg);
        }

        .sidebar.active ~ .menu-toggle .fa-xmark {
            opacity: 1;
            transform: rotate(0deg);
        }

        .main-content {
            padding-top: 20px;
            padding-bottom: 20px;
            transition: margin-left var(--transition-speed) ease-in-out;
        }

        @media (min-width: 769px) {
            .sidebar.active ~ .main-content {
                margin-left: var(--sidebar-width);
            }
        }

        @media (max-width: 768px) {
            .sidebar.active ~ .main-content {
                margin-left: 0;
            }

            .sidebar.active ~ .menu-toggle {
                left: calc(var(--sidebar-width) - 60px);
                color: var(--text-color);
                background: transparent;
                border: none;
                box-shadow: none;
            }
        }

        /* Styles for search suggestions */
        .search-container {
            position: relative;
        }

        .suggestions-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--secondary-color);
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
        }

        .suggestions-list li {
            padding: 10px 15px;
            color: var(--text-color);
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .suggestions-list li:last-child {
            border-bottom: none;
        }

        .suggestions-list li:hover {
            background-color: var(--hover-color);
        }
    </style>
</head>
<body>
<div id="root-app"></div>

<script type="text/babel">
    let booksData = [];
    let descriptionsData = {};

    // Função para carregar os dados dos livros e descrições
    async function loadBooksData() {
        try {
            const r = await fetch('./data/books.yml');
            if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
            const e = await r.text();
            
            // Simular dados adicionais que deveriam vir do YAML
            // Você DEVE atualizar seu books.yml para incluir essas propriedades!
            const rawBooks = jsyaml.load(e);
            booksData = rawBooks.map(book => ({
                ...book,
                publicationYear: book.publicationYear || Math.floor(Math.random() * (2023 - 1980 + 1)) + 1980, // Exemplo de ano aleatório se não existir
                system: book.system || (['D&D 5E', 'Tormenta', 'Chamado de Cthulhu', 'Mundo das Trevas'])[Math.floor(Math.random() * 4)], // Exemplo de sistema
                language: book.language || (['Português', 'Inglês'])[Math.floor(Math.random() * 2)], // Exemplo de idioma
                materialType: book.materialType || (['Livro Básico', 'Suplemento', 'Aventura', 'Guia'])[Math.floor(Math.random() * 4)], // Exemplo de tipo
            }));

            console.log('Dados dos livros carregados:', booksData);

            const descRes = await fetch('./data/descriptions.yml');
            if (!descRes.ok) throw new Error(`HTTP error! status: ${descRes.status}`);
            const descText = await descRes.text();
            descriptionsData = jsyaml.load(descText).reduce((acc, item) => {
                acc[item.title] = item.description;
                return acc;
            }, {});
            console.log('Dados das descrições carregados:', descriptionsData);

            ReactDOM.createRoot(document.getElementById('root-app')).render(<App/>);
        } catch (r) {
            console.error('Erro ao carregar os dados:', r);
            document.getElementById('root-app').innerHTML = '<p class="text-red-500 text-center text-xl mt-20">Erro ao carregar os livros. Por favor, tente novamente mais tarde.</p>';
        }
    }

    loadBooksData();

    // Componente para a visualização em grade
    const Book = ({title, author, imageUrl, onSelectBook}) => {
        return (
            <article className="bg-gray-800 bg-opacity-0 hover:bg-opacity-50 p-4 rounded-lg shadow-lg flex flex-col items-center text-center transform hover:scale-105 transition-all duration-300 ease-in-out cursor-pointer h-full" onClick={onSelectBook}>
                <figure className="book-cover mb-4 flex-shrink-0">
                    <img src={imageUrl} alt={title} className="w-48 h-64 object-cover rounded-md shadow-md" loading="lazy" onError={e => {
                        e.target.onerror = null;
                        e.target.src = "https://placehold.co/192x256/2d3748/e2e8f0?text=Capa"
                    }}/>
                </figure>
                <div className="book-info flex flex-col justify-start flex-grow">
                    <h2 className="text-white text-lg font-semibold mb-1">{title}</h2>
                    <p className="text-gray-400 text-sm">{author}</p>
                </div>
            </article>
        );
    };

    // Componente para a visualização em lista
    const BookListItem = ({ title, author, imageUrl, onSelectBook, publicationYear, system, language, materialType }) => {
        return (
            <article className="bg-gray-800 bg-opacity-50 p-4 rounded-lg shadow-lg flex flex-col sm:flex-row items-center sm:items-start space-y-4 sm:space-y-0 sm:space-x-4 transform hover:scale-[1.02] transition-all duration-300 ease-in-out cursor-pointer w-full">
                <figure className="flex-shrink-0">
                    <img src={imageUrl} alt={title} className="w-24 h-32 object-cover rounded-md shadow-md" loading="lazy" onError={e => { e.target.onerror = null; e.target.src = "https://placehold.co/96x128/2d3748/e2e8f0?text=Capa"; }} />
                </figure>
                <div className="flex-grow text-center sm:text-left">
                    <h2 className="text-white text-xl font-semibold mb-1">{title}</h2>
                    <p className="text-gray-400 text-base">Por: {author}</p>
                    {publicationYear && <p className="text-gray-500 text-sm">Ano: {publicationYear}</p>}
                    {system && <p className="text-gray-500 text-sm">Sistema: {system}</p>}
                    {language && <p className="text-gray-500 text-sm">Idioma: {language}</p>}
                    {materialType && <p className="text-gray-500 text-sm">Tipo: {materialType}</p>}
                </div>
                <button onClick={onSelectBook} className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md flex-shrink-0">Ver Detalhes</button>
            </article>
        );
    };

    // Componente de detalhes do livro
    const BookDetail = ({book, onBackToList}) => {
        return (
            <div className="flex flex-col items-center bg-gray-800 bg-opacity-50 p-8 rounded-lg shadow-xl max-w-4xl mx-auto my-8">
                <button onClick={onBackToList} className="self-start mb-6 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md">&larr; Voltar</button>
                <h1 className="text-white text-4xl md:text-5xl font-bold mb-4 text-center">{book.title}</h1>
                <p className="text-gray-300 text-lg mb-6 text-center">Por: {book.author}</p>
                <div className="book-cover mb-8">
                    <a href={book.driveLink} target="_blank" rel="noopener noreferrer">
                        <img src={book.imageUrl} alt={book.title}
                             className="w-80 h-auto object-cover rounded-lg shadow-lg border-4 border-gray-700 hover:border-green-500 transition-colors"
                             loading="lazy" onError={e => {
                            e.target.onerror = null;
                            e.target.src = "https://placehold.co/320x420/2d3748/e2e8f0?text=Capa+Indisponível"
                        }}/>
                    </a>
                </div>
                <a href={book.driveLink} target="_blank" rel="noopener noreferrer"
                   className="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors">Acessar no Google Drive</a>
                <p className="text-gray-400 text-sm mt-4 text-center">Clique na capa ou no botão para abrir o arquivo no Google Drive.</p>
                {book.description && (
                    <p className="text-gray-300 text-base mt-6 text-center leading-relaxed max-w-prose">{book.description}</p>
                )}
                <div className="mt-4 text-gray-400 text-sm text-center">
                    {book.publicationYear && <p><strong>Ano de Publicação:</strong> {book.publicationYear}</p>}
                    {book.system && <p><strong>Sistema:</strong> {book.system}</p>}
                    {book.language && <p><strong>Idioma:</strong> {book.language}</p>}
                    {book.materialType && <p><strong>Tipo de Material:</strong> {book.materialType}</p>}
                </div>
            </div>
        );
    };

    // Componente da barra lateral
    const Sidebar = ({isMenuOpen, toggleMenu, handleNavigate}) => {
        const [activeDropdown, setActiveDropdown] = React.useState(null);
        const submenuRefs = React.useRef({});

        React.useEffect(() => {
            const e = document.getElementById('sidebar');
            if (e) {
                if (isMenuOpen) {
                    e.classList.add('active');
                } else {
                    e.classList.remove('active');
                }
            }
        }, [isMenuOpen]);

        React.useEffect(() => {
            Object.keys(submenuRefs.current).forEach(e => {
                const t = submenuRefs.current[e];
                t && (activeDropdown === e ? t.style.maxHeight = t.scrollHeight + 'px' : t.style.maxHeight = '0px')
            })
        }, [activeDropdown]);

        const toggleDropdown = e => {
            setActiveDropdown(activeDropdown === e ? null : e)
        };

        const handleNavLinkClick = (e, t) => {
            handleNavigate(e, t);
            if (window.innerWidth <= 768) toggleMenu()
        };

        const categories = {
            'Dungeons & Dragons': ['D&D 5E', 'D&D 3.5'],
            'Mundo das Trevas': ['Mago a Ascensão', 'Vampiro a Máscara', 'Vampiro a Idade das Trevas', 'Vampiro o Réquiem'],
            'Cthulhu Mythos': ['Chamado de Cthulhu', 'Rastro de Cthulhu'],
            'Outros Sistemas': ['Tormenta', 'Old Dragon', '13ª Era', '7º Mar', 'Violentina', 'Angus RPG', '2Q RPG', 'Ação!!!']
        };

        return (
            <nav className="sidebar" id="sidebar">
                <div className="sidebar-header">
                    <i className="fa-solid fa-dungeon logo-icon"></i>
                    <span className="logo-text">Bib. Druídica</span>
                </div>
                <ul className="sidebar-nav">
                    <li className="nav-item">
                        <a className="nav-link" onClick={() => handleNavLinkClick('home')}>
                            <i className="fa-solid fa-house icon"></i>
                            <span className="text">Início</span>
                        </a>
                    </li>
                    <li className="nav-item">
                        <a className="nav-link" onClick={() => handleNavLinkClick('recent-views')}>
                            <i className="fa-solid fa-clock-rotate-left icon"></i>
                            <span className="text">Histórico Recente</span>
                        </a>
                    </li>
                    {Object.entries(categories).map(([e, t]) => (
                        <li key={e} className={`nav-item has-dropdown ${activeDropdown === e ? 'dropdown-active' : ''}`}>
                            <a className="nav-link" onClick={() => toggleDropdown(e)}>
                                <i className={`fa-solid ${e === 'Dungeons & Dragons' ? 'fa-dragon' : e === 'Mundo das Trevas' ? 'fa-hat-wizard' : e === 'Cthulhu Mythos' ? 'fa-book-skull' : 'fa-scroll'} icon`}></i>
                                <span className="text">{e}</span>
                                <i className="fa-solid fa-chevron-right dropdown-arrow"></i>
                            </a>
                            <ul className="submenu" ref={a => submenuRefs.current[e] = a}>
                                {t.map(s => (
                                    <li key={s}>
                                        <a className="submenu-link" onClick={() => handleNavLinkClick('category', s)}>{s}</a>
                                    </li>
                                ))}
                            </ul>
                        </li>
                    ))}
                </ul>
            </nav>
        );
    };

    // Componente principal da aplicação
    const App = () => {
        const [currentView, setCurrentView] = React.useState('home');
        const [selectedCategory, setSelectedCategory] = React.useState('');
        const [selectedBook, setSelectedBook] = React.useState(null);
        const [searchTerm, setSearchTerm] = React.useState('');
        const [isMenuOpen, setIsMenuOpen] = React.useState(false);
        const [currentPage, setCurrentPage] = React.useState(1);
        const [booksPerPage, setBooksPerPage] = React.useState(20);
        const booksPerPageOptions = [20, 40, 60];

        // Novos estados para funcionalidades adicionais
        const [recentBooks, setRecentBooks] = React.useState([]);
        const [sortBy, setSortBy] = React.useState('title'); // 'title', 'author', 'publicationYear'
        const [filterAuthor, setFilterAuthor] = React.useState('');
        const [filterSystem, setFilterSystem] = React.useState('');
        const [filterYear, setFilterYear] = React.useState('');
        const [filterLanguage, setFilterLanguage] = React.useState('');
        const [filterMaterialType, setFilterMaterialType] = React.useState('');
        const [viewMode, setViewMode] = React.useState('grid'); // 'grid' ou 'list'
        const [suggestions, setSuggestions] = React.useState([]);


        // Efeito para carregar o histórico de visualização ao iniciar
        React.useEffect(() => {
            const storedRecent = JSON.parse(localStorage.getItem('recentBooks') || '[]');
            setRecentBooks(storedRecent);
        }, []);

        // Função para adicionar um livro ao histórico de visualização
        const addRecentBook = (book) => {
            setRecentBooks((prev) => {
                const updated = [book, ...prev.filter(b => b.driveLink !== book.driveLink)];
                const limited = updated.slice(0, 10); // Limite de 10 livros recentes
                localStorage.setItem('recentBooks', JSON.stringify(limited));
                return limited;
            });
        };

        // Função de navegação
        const handleNavigate = (e, t = '') => {
            setCurrentView(e);
            setSelectedCategory(t);
            setSelectedBook(null);
            setSearchTerm('');
            setFilterAuthor(''); // Resetar filtros avançados ao navegar
            setFilterSystem('');
            setFilterYear('');
            setFilterLanguage('');
            setFilterMaterialType('');
            setSuggestions([]); // Limpar sugestões
            setCurrentPage(1);
            window.scrollTo(0, 0);
        };

        // Função para selecionar um livro e adicionar ao histórico
        const handleSelectBook = book => {
            const description = descriptionsData[book.title] || 'Nenhuma descrição disponível neste tomo.';
            setSelectedBook({...book, description});
            addRecentBook(book); // Adiciona ao histórico
            setCurrentView('book');
            window.scrollTo(0, 0);
        };

        // Função para alternar o menu lateral
        const toggleMenu = () => {
            setIsMenuOpen(e => !e)
        };

        // Função para alterar a quantidade de livros por página
        const handleBooksPerPageChange = e => {
            setBooksPerPage(Number(e.target.value));
            setCurrentPage(1);
        };

        // Função para lidar com a mudança na barra de pesquisa e gerar sugestões
        const handleSearchInputChange = (e) => {
            const value = e.target.value;
            setSearchTerm(value);

            if (value.length > 2) {
                const matchingBooks = booksData.filter(book =>
                    book.title.toLowerCase().includes(value.toLowerCase()) ||
                    book.author.toLowerCase().includes(value.toLowerCase()) ||
                    (descriptionsData[book.title] && descriptionsData[book.title].toLowerCase().includes(value.toLowerCase())) // Busca na descrição
                ).slice(0, 7); // Limita sugestões
                setSuggestions(matchingBooks);
            } else {
                setSuggestions([]);
            }
        };

        // Lógica de filtragem e ordenação (otimizada com useMemo)
        const processedBooks = React.useMemo(() => {
            let tempBooks = booksData;

            // Filtro por categoria
            if (currentView === 'category' && selectedCategory) {
                tempBooks = tempBooks.filter(book => book.category === selectedCategory);
            } else if (currentView === 'recent-views') {
                // Se estiver na view de histórico, usa apenas os livros recentes
                tempBooks = recentBooks;
            }

            // Filtro por termo de busca (título, autor, descrição)
            if (searchTerm) {
                tempBooks = tempBooks.filter(book =>
                    book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    book.author.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (descriptionsData[book.title] && descriptionsData[book.title].toLowerCase().includes(searchTerm.toLowerCase()))
                );
            }

            // Filtros avançados
            if (filterAuthor) {
                tempBooks = tempBooks.filter(book => book.author.toLowerCase().includes(filterAuthor.toLowerCase()));
            }
            if (filterSystem) {
                tempBooks = tempBooks.filter(book => book.system === filterSystem);
            }
            if (filterYear) {
                tempBooks = tempBooks.filter(book => String(book.publicationYear) === filterYear);
            }
            if (filterLanguage) {
                tempBooks = tempBooks.filter(book => book.language === filterLanguage);
            }
            if (filterMaterialType) {
                tempBooks = tempBooks.filter(book => book.materialType === filterMaterialType);
            }

            // Ordenação
            let sortedBooks = [...tempBooks];
            if (sortBy === 'title') {
                sortedBooks.sort((a, b) => a.title.localeCompare(b.title));
            } else if (sortBy === 'author') {
                sortedBooks.sort((a, b) => a.author.localeCompare(b.author));
            } else if (sortBy === 'publicationYear') {
                sortedBooks.sort((a, b) => (a.publicationYear || 0) - (b.publicationYear || 0));
            }
            // Adicione mais critérios de ordenação se necessário (ex: popularidade, que precisaria ser um dado no livro)

            return sortedBooks;
        }, [booksData, currentView, selectedCategory, searchTerm, recentBooks, sortBy, filterAuthor, filterSystem, filterYear, filterLanguage, filterMaterialType, descriptionsData]);


        const filteredBooksCount = processedBooks.length;
        const totalPages = Math.ceil(filteredBooksCount / booksPerPage);

        const booksForDisplay = React.useMemo(() => {
            const t = currentPage * booksPerPage;
            const s = t - booksPerPage;
            return processedBooks.slice(s, t);
        }, [processedBooks, currentPage, booksPerPage]);

        // Componente de controles de paginação
        const PaginationControls = ({currentPage, totalPages, setCurrentPage}) => {
            if (totalPages <= 1) return null;
            return (
                <div className="flex justify-center items-center mt-8 mb-8 space-x-4 flex-wrap gap-2">
                    <button onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                            disabled={currentPage === 1}
                            className="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md">
                        Anterior
                    </button>
                    {[...Array(totalPages)].map((e, t) => (
                        <button key={t + 1} onClick={() => setCurrentPage(t + 1)}
                                className={`px-4 py-2 rounded-lg transition-colors shadow-md ${currentPage === t + 1 ? 'bg-green-600 text-white' : 'bg-gray-700 text-white hover:bg-gray-600'}`}>
                            {t + 1}
                        </button>
                    ))}
                    <button onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                            disabled={currentPage === totalPages}
                            className="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md">
                        Próximo
                    </button>
                </div>
            );
        };

        // Opções para os filtros avançados (pode vir de uma API ou YML futuramente)
        const uniqueAuthors = [...new Set(booksData.map(book => book.author))].sort();
        const uniqueSystems = [...new Set(booksData.map(book => book.system))].sort();
        const uniqueYears = [...new Set(booksData.map(book => book.publicationYear))].sort((a, b) => a - b);
        const uniqueLanguages = [...new Set(booksData.map(book => book.language))].sort();
        const uniqueMaterialTypes = [...new Set(booksData.map(book => book.materialType))].sort();


        // Renderização condicional do conteúdo principal
        const renderContent = () => {
            if (currentView === 'book' && selectedBook) {
                return <BookDetail book={selectedBook} onBackToList={() => handleNavigate(selectedCategory ? 'category' : currentView === 'recent-views' ? 'recent-views' : 'home', selectedCategory)}/>;
            }

            let pageTitle = "Biblioteca Druídica";
            let pageDescription = "Seu acervo digital de livros de RPG.";

            if (currentView === 'category') {
                pageTitle = selectedCategory;
                pageDescription = `Livros e suplementos para ${selectedCategory}.`;
            } else if (currentView === 'recent-views') {
                pageTitle = "Histórico de Visualização Recente";
                pageDescription = "Os últimos livros que você acessou.";
            }

            return (
                <>
                    <div className="text-center mb-10 pt-12">
                        <h1 className="text-4xl md:text-5xl font-bold mb-2 text-white">{pageTitle}</h1>
                        <p className="text-lg text-gray-300">{pageDescription}</p>
                        {(currentView === 'category' || currentView === 'recent-views') && (
                            <button onClick={() => handleNavigate('home')}
                                    className="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-md">
                                &larr; Voltar para o Início
                            </button>
                        )}
                    </div>

                    <div className="flex flex-col md:flex-row justify-center items-center gap-4 mb-8">
                        <div className="relative w-full max-w-lg search-container">
                            <input
                                type="text"
                                placeholder="Buscar por título, autor ou descrição..."
                                className="w-full px-5 py-3 bg-gray-700 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 transition-shadow"
                                onChange={handleSearchInputChange}
                                value={searchTerm}
                            />
                            {suggestions.length > 0 && searchTerm.length > 2 && (
                                <ul className="suggestions-list">
                                    {suggestions.map(book => (
                                        <li key={book.driveLink} onClick={() => handleSelectBook(book)}>
                                            {book.title} por {book.author}
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </div>
                        
                        <div className="flex flex-col sm:flex-row gap-4 w-full md:w-auto">
                            <div className="relative w-full sm:w-auto">
                                <select value={sortBy} onChange={(e) => setSortBy(e.target.value)}
                                        className="appearance-none w-full px-5 py-3 rounded-full transition-shadow pr-10 cursor-pointer bg-gray-700 border border-gray-600 shadow-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                    <option value="title">Ordenar por: Título</option>
                                    <option value="author">Ordenar por: Autor</option>
                                    <option value="publicationYear">Ordenar por: Ano</option>
                                </select>
                                <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                                    <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.096 6.924 4.682 8.338 9.293 12.95z"/></svg>
                                </div>
                            </div>

                            <div className="relative w-full sm:w-auto">
                                <select value={booksPerPage} onChange={handleBooksPerPageChange}
                                        className="appearance-none w-full px-5 py-3 rounded-full transition-shadow pr-10 cursor-pointer bg-gray-700 border border-gray-600 shadow-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                    <option value="20">Mostrar: 20 livros</option>
                                    <option value="40">Mostrar: 40 livros</option>
                                    <option value="60">Mostrar: 60 livros</option>
                                </select>
                                <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                                    <svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.096 6.924 4.682 8.338 9.293 12.95z"/></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* Filtros Avançados */}
                    <div className="flex flex-wrap justify-center gap-4 mb-8">
                        <div className="relative w-full sm:w-48">
                            <select value={filterAuthor} onChange={e => setFilterAuthor(e.target.value)}
                                    className="appearance-none w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 shadow-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="">Todos os Autores</option>
                                {uniqueAuthors.map(author => <option key={author} value={author}>{author}</option>)}
                            </select>
                            <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400"><svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.096 6.924 4.682 8.338 9.293 12.95z"/></svg></div>
                        </div>
                        <div className="relative w-full sm:w-48">
                            <select value={filterSystem} onChange={e => setFilterSystem(e.target.value)}
                                    className="appearance-none w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 shadow-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="">Todos os Sistemas</option>
                                {uniqueSystems.map(system => <option key={system} value={system}>{system}</option>)}
                            </select>
                            <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400"><svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.096 6.924 4.682 8.338 9.293 12.95z"/></svg></div>
                        </div>
                        <div className="relative w-full sm:w-48">
                            <select value={filterYear} onChange={e => setFilterYear(e.target.value)}
                                    className="appearance-none w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 shadow-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="">Todos os Anos</option>
                                {uniqueYears.map(year => <option key={year} value={year}>{year}</option>)}
                            </select>
                            <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400"><svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.096 6.924 4.682 8.338 9.293 12.95z"/></svg></div>
                        </div>
                        <div className="relative w-full sm:w-48">
                            <select value={filterLanguage} onChange={e => setFilterLanguage(e.target.value)}
                                    className="appearance-none w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 shadow-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="">Todos os Idiomas</option>
                                {uniqueLanguages.map(lang => <option key={lang} value={lang}>{lang}</option>)}
                            </select>
                            <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400"><svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.096 6.924 4.682 8.338 9.293 12.95z"/></svg></div>
                        </div>
                        <div className="relative w-full sm:w-48">
                            <select value={filterMaterialType} onChange={e => setFilterMaterialType(e.target.value)}
                                    className="appearance-none w-full px-4 py-2 rounded-lg bg-gray-700 text-white border border-gray-600 shadow-md focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="">Todos os Tipos</option>
                                {uniqueMaterialTypes.map(type => <option key={type} value={type}>{type}</option>)}
                            </select>
                            <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400"><svg className="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 6.096 6.924 4.682 8.338 9.293 12.95z"/></svg></div>
                        </div>
                    </div>

                    {/* Modo de Visualização */}
                    <div className="flex justify-center mb-8">
                        <button onClick={() => setViewMode('grid')}
                                className={`px-4 py-2 rounded-l-lg transition-colors shadow-md ${viewMode === 'grid' ? 'bg-green-600 text-white' : 'bg-gray-700 text-white hover:bg-gray-600'}`}>
                            <i className="fa-solid fa-grip"></i> Grade
                        </button>
                        <button onClick={() => setViewMode('list')}
                                className={`px-4 py-2 rounded-r-lg transition-colors shadow-md ${viewMode === 'list' ? 'bg-green-600 text-white' : 'bg-gray-700 text-white hover:bg-gray-600'}`}>
                            <i className="fa-solid fa-list"></i> Lista
                        </button>
                    </div>

                    <PaginationControls currentPage={currentPage} totalPages={totalPages} setCurrentPage={setCurrentPage}/>

                    <section className={viewMode === 'grid' ? "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-8" : "flex flex-col gap-4"}>
                        {booksForDisplay.length > 0 ? booksForDisplay.map(e => (
                            viewMode === 'grid' ? (
                                <Book key={e.driveLink} title={e.title} author={e.author} imageUrl={e.imageUrl} onSelectBook={() => handleSelectBook(e)}/>
                            ) : (
                                <BookListItem key={e.driveLink} title={e.title} author={e.author} imageUrl={e.imageUrl} publicationYear={e.publicationYear} system={e.system} language={e.language} materialType={e.materialType} onSelectBook={() => handleSelectBook(e)}/>
                            )
                        )) : (
                            <p className="col-span-full text-center text-gray-400 text-xl">Nenhum livro encontrado.</p>
                        )}
                    </section>

                    <PaginationControls currentPage={currentPage} totalPages={totalPages} setCurrentPage={setCurrentPage}/>
                </>
            );
        };

        // Efeitos para controle do menu lateral
        React.useEffect(() => {
            const e = document.getElementById('sidebar');
            const t = document.querySelector('.menu-toggle');
            const s = a => {
                if (e && t && isMenuOpen && !e.contains(a.target) && !t.contains(a.target)) {
                    setIsMenuOpen(false);
                }
            };
            document.addEventListener('mousedown', s);
            if (isMenuOpen && window.innerWidth <= 768) {
                document.body.style.marginLeft = '0';
                document.body.classList.add('overflow-hidden')
            } else if (isMenuOpen && window.innerWidth > 768) {
                document.body.style.marginLeft = 'var(--sidebar-width)'
            } else {
                document.body.style.marginLeft = '0';
                document.body.classList.remove('overflow-hidden')
            }
            return () => {
                document.removeEventListener('mousedown', s)
            }
        }, [isMenuOpen]);

        // Efeito para prevenir o menu de contexto (botão direito do mouse)
        React.useEffect(() => {
            const e = e => e.preventDefault();
            document.addEventListener('contextmenu', e);
            return () => document.removeEventListener('contextmenu', e)
        }, []);

        return (
            <div className="min-h-screen text-gray-100 font-inter antialiased">
                <Sidebar isMenuOpen={isMenuOpen} toggleMenu={toggleMenu} handleNavigate={handleNavigate}/>
                <button className={`menu-toggle ${isMenuOpen ? 'active' : ''}`} onClick={toggleMenu} aria-label="Toggle menu">
                    <i className={`fa-solid fa-bars ${isMenuOpen ? 'hidden' : ''}`}></i>
                    <i className={`fa-solid fa-xmark ${isMenuOpen ? '' : 'hidden'}`}></i>
                </button>
                <main className="container mx-auto px-4 py-8">
                    {renderContent()}
                </main>
                <footer className="bg-black bg-opacity-30 backdrop-blur-sm p-6 text-center text-gray-400 mt-12 rounded-t-lg">
                    <p>&copy; {new Date().getFullYear()} Biblioteca Druídica. Todos os direitos reservados.</p>
                    <div className="mt-4">
                        <p>Visite o canal na Twitch: <a href="https://www.twitch.tv/lukas_eso" target="_blank" rel="noopener noreferrer" className="text-purple-400 hover:underline">lukas_eso</a></p>
                    </div>
                </footer>
            </div>
        );
    };
</script>
</body>
</html>
